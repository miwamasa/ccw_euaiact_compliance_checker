# EU AI Act Compliance Checker - Optimized Version (EC Service Desk Based)
# Generated by optimization_engine.py
# Optimization: Information-theoretic decision tree with early termination

metadata:
  title: "EU AI法コンプライアンスチェッカー（最適化版）"
  version: "2.0"
  source: "https://ai-act-service-desk.ec.europa.eu/en/eu-ai-act-compliance-checker"
  updated: "2026-01-31"
  optimization_approach: "情報理論に基づく決定木、早期終了による効率化"
  original_questions: 33
  optimized_questions: 20
  paths_analyzed: 7762
  average_path_length: 8.60
  average_path_reduction: "20-30%"

# Optimization Statistics from Engine
optimization_stats:
  path_analysis:
    shortest: 2
    longest: 12
    average: 8.60
    median: 8
  high_value_questions:
    - id: "QAIS 6.3"
      information_gain: 4.6509
    - id: "QGPAI 3.1"
      information_gain: 4.6497
    - id: "QGPAI 7"
      information_gain: 4.6496
  early_termination_points:
    - id: "QAIS 5"
      terminal_probability: 0.615
    - id: "QAIS 7.1"
      terminal_probability: 1.0
    - id: "QGPAI 3.1"
      terminal_probability: 0.714
    - id: "QGPAI 7"
      terminal_probability: 1.0

# 決定フラグ（最終出力）
decision_flags:
  # 主要ステータスフラグ
  flag_out_of_scope: boolean           # EU AI法の適用範囲外
  flag_prohibited: boolean             # 第5条により禁止
  flag_excluded: boolean               # 除外（研究、オープンソース等）
  flag_high_risk: boolean              # ハイリスクに分類
  flag_gpai: boolean                   # 汎用AIモデル
  flag_gpai_systemic_risk: boolean     # システミックリスクを持つGPAI

  # エンティティ分類フラグ
  flag_is_provider: boolean
  flag_is_deployer: boolean
  flag_is_distributor: boolean
  flag_is_importer: boolean
  flag_is_product_manufacturer: boolean
  flag_becomes_provider: boolean       # 変更により提供者になる

  # 義務フラグ
  obligation_ai_literacy: boolean
  obligation_provider_high_risk: boolean      # 第16条
  obligation_deployer_high_risk: boolean      # 第26条
  obligation_gpai_base: boolean               # 第53条
  obligation_gpai_systemic: boolean           # 第55条
  obligation_transparency_natural_persons: boolean      # 第50条(1)
  obligation_transparency_synthetic_content: boolean    # 第50条(2)
  obligation_transparency_emotion_biometric: boolean    # 第50条(3)
  obligation_transparency_content_resemblance: boolean  # 第50条(4)
  obligation_fundamental_rights_assessment: boolean     # 第27条

# =============================================================================
# 最適化された質問フロー
# =============================================================================

optimized_questions:

  # ---------------------------------------------------------------------------
  # Q1: エントリーポイント - AIモデル vs AIシステム
  # ---------------------------------------------------------------------------
  Q1:
    id: "Q1"
    priority: 1
    information_gain: 0.0248
    rationale: "エントリーポイント - GPAIとAIシステムのトラック分岐"
    question: "AIモデルとAIシステムのどちらをチェックしますか？"
    type: "radio"
    options:
      - value: 0
        label: "AIモデル（汎用AI）"
        next: "QGPAI_1"
      - value: 1
        label: "AIシステム"
        next: "QAIS_1"

  # ===========================================================================
  # GPAI トラック (5質問、平均パス長: 4-5)
  # ===========================================================================

  QGPAI_1:
    id: "QGPAI_1"
    priority: 2
    information_gain: 4.6432
    terminal_probability: 0.053
    question: "あなたのAIモデルは汎用AIモデルですか？"
    info: "様々なタスクに対応可能なAIモデル（例：大規模言語モデル）"
    type: "radio"
    options:
      - value: 0
        label: "はい"
        sets_flags:
          flag_gpai: true
        next: "QGPAI_2"
      - value: 1
        label: "いいえ"
        terminal: true
        result: "NOT_GPAI"

  QGPAI_2:
    id: "QGPAI_2"
    priority: 3
    information_gain: 4.6455
    question: "GPAIモデルをEU市場に投入していますか？"
    type: "radio"
    options:
      - value: 0
        label: "はい - プロバイダーとして"
        sets_flags:
          flag_is_provider: true
        next: "QGPAI_3"
      - value: 1
        label: "はい - 下流プロバイダーを通じて"
        next: "QGPAI_3"

  QGPAI_3:
    id: "QGPAI_3"
    priority: 4
    information_gain: 4.6469
    terminal_probability: 0.389
    question: "モデルはシステミックリスクを持ちますか？"
    info: "10^25 FLOPs以上の計算能力、または欧州委員会による指定"
    type: "radio"
    options:
      - value: 0
        label: "はい - 高影響力のモデル"
        sets_flags:
          flag_gpai_systemic_risk: true
          obligation_gpai_systemic: true
        terminal: true
        result: "GPAI_SYSTEMIC"
      - value: 1
        label: "いいえ"
        next: "QGPAI_3_1"
      - value: 2
        label: "わからない"
        next: "QGPAI_3_1"

  QGPAI_3_1:
    id: "QGPAI_3_1"
    priority: 5
    information_gain: 4.6497
    terminal_probability: 0.714
    question: "オープンソースモデルの例外に該当しますか？"
    type: "radio"
    options:
      - value: 0
        label: "はい - オープンソース例外適用"
        terminal: true
        result: "GPAI_OPENSOURCE"
      - value: 1
        label: "いいえ"
        next: "QGPAI_7"

  QGPAI_7:
    id: "QGPAI_7"
    priority: 6
    information_gain: 4.6496
    terminal_probability: 1.0
    question: "GPAIの透明性義務を確認"
    info: "第53条に基づく義務"
    type: "checkbox"
    options:
      - value: 0
        label: "技術文書の作成"
      - value: 1
        label: "下流プロバイダーへの情報提供"
      - value: 2
        label: "著作権ポリシーの遵守"
      - value: 3
        label: "学習データの要約の公開"
    terminal: true
    sets_flags:
      obligation_gpai_base: true
    result: "GPAI_PROVIDER"

  # ===========================================================================
  # AI System トラック (最大14質問、平均パス長: 8.6)
  # ===========================================================================

  QAIS_1:
    id: "QAIS_1"
    priority: 2
    information_gain: 0.0349
    question: "あなたのシステムはAIシステムの定義に該当しますか？"
    info: "第3条(1)の定義：機械ベースのシステムで、様々な程度の自律性で動作"
    type: "radio"
    options:
      - value: 0
        label: "はい"
        next: "QAIS_2"
      - value: 1
        label: "いいえ - AIシステムではない"
        terminal: true
        sets_flags:
          flag_out_of_scope: true
        result: "NOT_AI_SYSTEM"
      - value: 2
        label: "わからない"
        next: "QAIS_1_1"

  QAIS_1_1:
    id: "QAIS_1_1"
    priority: 3
    information_gain: 0.6944
    question: "システムは以下の特性を持っていますか？"
    type: "checkbox"
    options:
      - value: 0
        label: "機械ベースである"
      - value: 1
        label: "様々な程度の自律性で動作"
      - value: 2
        label: "展開後に適応性を示す可能性"
      - value: 3
        label: "入力から推論を行い出力を生成"
      - value: 4
        label: "物理的または仮想環境に影響"
      - value: 5
        label: "上記いずれにも該当しない"
        exclusive: true
        terminal: true
        sets_flags:
          flag_out_of_scope: true
        result: "NOT_AI_SYSTEM"
    next: "QAIS_2"

  QAIS_2:
    id: "QAIS_2"
    priority: 4
    information_gain: 2.4332
    question: "AIシステムにおけるあなたの役割は？"
    type: "radio"
    options:
      - value: 0
        label: "プロバイダー"
        sets_flags:
          flag_is_provider: true
        next: "QAIS_3"
      - value: 1
        label: "デプロイヤー"
        sets_flags:
          flag_is_deployer: true
        next: "QAIS_2_1"
      - value: 2
        label: "インポーター"
        sets_flags:
          flag_is_importer: true
        next: "QAIS_2_1"
      - value: 3
        label: "ディストリビューター"
        sets_flags:
          flag_is_distributor: true
        next: "QAIS_2_1"
      - value: 4
        label: "認定代理人"
        next: "QAIS_3"
      - value: 5
        label: "製品製造者"
        sets_flags:
          flag_is_product_manufacturer: true
        next: "QAIS_2_2"
      - value: 6
        label: "上記のいずれでもない"
        terminal: true
        result: "OUT_OF_SCOPE_ROLE"

  QAIS_2_1:
    id: "QAIS_2_1"
    priority: 5
    information_gain: 2.2282
    question: "以下のいずれかに該当しますか？（プロバイダー責任の発生）"
    type: "checkbox"
    options:
      - value: 0
        label: "自社名義でAIシステムを市場投入"
        sets_flags:
          flag_becomes_provider: true
          flag_is_provider: true
      - value: 1
        label: "用途変更を行った"
        sets_flags:
          flag_becomes_provider: true
          flag_is_provider: true
      - value: 2
        label: "実質的な変更を行った"
        sets_flags:
          flag_becomes_provider: true
          flag_is_provider: true
      - value: 3
        label: "いずれにも該当しない"
        exclusive: true
    next: "QAIS_3"

  QAIS_2_2:
    id: "QAIS_2_2"
    priority: 5
    information_gain: 4.3986
    question: "製品にAIシステムを統合していますか？"
    type: "checkbox"
    options:
      - value: 0
        label: "自社名義で市場投入"
        sets_flags:
          flag_becomes_provider: true
          flag_is_provider: true
      - value: 1
        label: "既存製品の用途変更"
        sets_flags:
          flag_becomes_provider: true
          flag_is_provider: true
      - value: 2
        label: "製品製造者としてのみ"
        terminal: true
        result: "PRODUCT_MANUFACTURER"
    next: "QAIS_3"

  QAIS_3:
    id: "QAIS_3"
    priority: 6
    information_gain: 0.1646
    question: "以下の除外規定に該当しますか？"
    type: "checkbox"
    options:
      - value: 0
        label: "軍事目的のみ"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_MILITARY"
      - value: 1
        label: "第三国の公的機関"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_THIRD_COUNTRY"
      - value: 2
        label: "国際協定に基づく法執行"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_INTERNATIONAL"
      - value: 3
        label: "科学研究のみ"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_RESEARCH"
      - value: 4
        label: "上記いずれにも該当しない"
        exclusive: true
    next: "QAIS_4"

  QAIS_4:
    id: "QAIS_4"
    priority: 7
    information_gain: 0.98
    terminal_probability: 0.235
    question: "以下の除外に該当しますか？"
    type: "checkbox"
    options:
      - value: 0
        label: "軍事・防衛目的のみ"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_DEFENSE"
      - value: 1
        label: "研究開発目的のみ"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_RD"
      - value: 2
        label: "個人的・非専門的使用"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_PERSONAL"
      - value: 3
        label: "オープンソース（未デプロイ）"
        terminal: true
        sets_flags:
          flag_excluded: true
        result: "EXCLUDED_OPENSOURCE"
      - value: 4
        label: "上記いずれにも該当しない"
        exclusive: true
    next: "QAIS_5"

  QAIS_5:
    id: "QAIS_5"
    priority: 8
    information_gain: 2.39
    terminal_probability: 0.615
    question: "禁止されるAI行為に該当しますか？（第5条）"
    type: "checkbox"
    options:
      - value: 0
        label: "サブリミナル操作"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 1
        label: "脆弱性の悪用"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 2
        label: "ソーシャルスコアリング"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 3
        label: "個人リスク予測（犯罪）"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 4
        label: "顔画像スクレイピング"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 5
        label: "職場・教育での感情認識"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 6
        label: "センシティブ特性による生体分類"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 7
        label: "公共空間でのリアルタイム生体認証"
        terminal: true
        sets_flags:
          flag_prohibited: true
        result: "PROHIBITED"
      - value: 8
        label: "上記いずれにも該当しない"
        exclusive: true
    next: "QAIS_6"

  QAIS_6:
    id: "QAIS_6"
    priority: 9
    information_gain: 3.7676
    question: "ハイリスクAIカテゴリに該当しますか？"
    type: "radio"
    options:
      - value: 0
        label: "附属書Iのセクションに該当（製品安全）"
        next: "QAIS_6_1"
      - value: 1
        label: "附属書IIIの用途に該当"
        next: "QAIS_6_4"
      - value: 2
        label: "両方に該当"
        next: "QAIS_6_1"
      - value: 3
        label: "いずれにも該当しない"
        next: "QAIS_7"

  QAIS_6_1:
    id: "QAIS_6_1"
    priority: 10
    information_gain: 3.7676
    question: "附属書Iのどのセクションに該当しますか？"
    type: "checkbox"
    options:
      - value: 0
        label: "機械規則"
      - value: 1
        label: "玩具安全"
      - value: 2
        label: "遊覧船"
      - value: 3
        label: "リフト"
      - value: 4
        label: "ATEX機器"
      - value: 5
        label: "無線機器"
      - value: 6
        label: "圧力機器"
      - value: 7
        label: "索道設備"
      - value: 8
        label: "個人用保護具"
      - value: 9
        label: "ガス燃焼器具"
      - value: 10
        label: "医療機器"
      - value: 11
        label: "体外診断用医療機器"
      - value: 12
        label: "上記いずれにも該当しない"
        exclusive: true
    next: "QAIS_6_2"

  QAIS_6_2:
    id: "QAIS_6_2"
    priority: 11
    information_gain: 3.7676
    terminal_probability: 0.175
    question: "第三者適合性評価が必要ですか？"
    type: "radio"
    options:
      - value: 0
        label: "はい - 第三者評価必須"
        sets_flags:
          flag_high_risk: true
        terminal: true
        result: "HIGH_RISK_ANNEX_I"
      - value: 1
        label: "いいえ / オプトアウト可能"
    next: "QAIS_6_4"

  QAIS_6_3:
    id: "QAIS_6_3"
    priority: 10
    information_gain: 4.6509
    question: "附属書IセクションBに該当しますか？"
    type: "checkbox"
    options:
      - value: 0
        label: "航空製品（民間航空）"
      - value: 1
        label: "二輪・三輪車両"
      - value: 2
        label: "農業・林業用車両"
      - value: 3
        label: "船舶機器"
      - value: 4
        label: "鉄道システム"
      - value: 5
        label: "自動車"
      - value: 6
        label: "無人航空機システム"
      - value: 7
        label: "上記いずれにも該当しない"
        exclusive: true
    next: "QAIS_6_4"

  QAIS_6_4:
    id: "QAIS_6_4"
    priority: 12
    information_gain: 3.5
    question: "附属書IIIのハイリスク用途に該当しますか？"
    type: "checkbox"
    options:
      - value: 0
        label: "生体認証・分類"
        sets_flags:
          flag_high_risk: true
      - value: 1
        label: "重要インフラ管理"
        sets_flags:
          flag_high_risk: true
      - value: 2
        label: "教育・職業訓練"
        sets_flags:
          flag_high_risk: true
      - value: 3
        label: "雇用・人事管理"
        sets_flags:
          flag_high_risk: true
      - value: 4
        label: "必須サービスへのアクセス"
        sets_flags:
          flag_high_risk: true
      - value: 5
        label: "法執行"
        sets_flags:
          flag_high_risk: true
      - value: 6
        label: "移民・国境管理"
        sets_flags:
          flag_high_risk: true
      - value: 7
        label: "司法・民主主義"
        sets_flags:
          flag_high_risk: true
      - value: 8
        label: "上記いずれにも該当しない"
        exclusive: true
    next: "QAIS_6_5"

  QAIS_6_5:
    id: "QAIS_6_5"
    priority: 13
    information_gain: 3.0
    question: "重大なリスクをもたらしますか？（ハイリスク例外の確認）"
    condition: "flag_high_risk == true"
    type: "radio"
    options:
      - value: 0
        label: "はい - 健康・安全・基本的権利に重大なリスク"
        sets_flags:
          flag_high_risk: true
        next: "QAIS_7_1"
      - value: 1
        label: "いいえ - 例外条件を満たす（第6条4項）"
        sets_flags:
          flag_high_risk: false
        next: "QAIS_7"

  QAIS_7:
    id: "QAIS_7"
    priority: 14
    information_gain: 2.0
    question: "透明性義務（第50条）"
    type: "checkbox"
    options:
      - value: 0
        label: "自然人との直接対話"
        sets_flags:
          obligation_transparency_natural_persons: true
      - value: 1
        label: "合成コンテンツ（音声/画像/動画/テキスト）生成"
        sets_flags:
          obligation_transparency_synthetic_content: true
      - value: 2
        label: "感情認識・生体分類"
        sets_flags:
          obligation_transparency_emotion_biometric: true
      - value: 3
        label: "ディープフェイク生成"
        sets_flags:
          obligation_transparency_content_resemblance: true
      - value: 4
        label: "公共の利益に関するテキスト生成"
        sets_flags:
          obligation_transparency_content_resemblance: true
      - value: 5
        label: "上記いずれにも該当しない"
        exclusive: true
    next: "QAIS_8"

  QAIS_7_1:
    id: "QAIS_7_1"
    priority: 14
    information_gain: 4.1793
    terminal_probability: 1.0
    question: "ハイリスクAIシステムの義務確認"
    condition: "flag_high_risk == true"
    type: "info"
    info: |
      ハイリスクAIシステムとして以下の義務が適用されます：
      - プロバイダー：第16条（リスク管理、データガバナンス、技術文書等）
      - デプロイヤー：第26条（使用監視、人間による監督）
      - 基本的権利影響評価（公的機関の場合）
    terminal: true
    sets_flags:
      obligation_provider_high_risk: true
      obligation_deployer_high_risk: true
    result: "HIGH_RISK"

  QAIS_8:
    id: "QAIS_8"
    priority: 15
    information_gain: 1.5
    question: "基本的権利影響評価の必要性"
    condition: "flag_is_deployer == true"
    type: "radio"
    options:
      - value: 0
        label: "公的機関または公共サービス提供者である"
        sets_flags:
          obligation_fundamental_rights_assessment: true
      - value: 1
        label: "該当しない"
    terminal: true
    result: "COMPLIANCE_REQUIRED"

# =============================================================================
# 結果マッピング
# =============================================================================

results:
  NOT_AI_SYSTEM:
    title: "AIシステムに該当しない"
    description: "EU AI法の適用範囲外です"
    obligations: []

  NOT_GPAI:
    title: "汎用AIモデルに該当しない"
    description: "GPAIとしての規制は適用されません"
    obligations: []

  OUT_OF_SCOPE_ROLE:
    title: "適用範囲外の役割"
    description: "EU AI法の規制対象外です"
    obligations: []

  EXCLUDED_MILITARY:
    title: "軍事目的により除外"
    description: "EU AI法の適用除外（第2条3項）"
    obligations: []

  EXCLUDED_RESEARCH:
    title: "研究目的により除外"
    description: "EU AI法の適用除外（第2条6項）"
    obligations: []

  EXCLUDED_PERSONAL:
    title: "個人使用により除外"
    description: "EU AI法の適用除外（第2条10項）"
    obligations: []

  EXCLUDED_OPENSOURCE:
    title: "オープンソースにより除外"
    description: "EU AI法の適用除外"
    obligations: []

  PROHIBITED:
    title: "禁止されるAI行為"
    description: "第5条に基づき禁止されています。EU市場への投入は不可。"
    obligations:
      - "システムの使用停止"
      - "EU市場への投入禁止"

  GPAI_SYSTEMIC:
    title: "システミックリスクを持つGPAI"
    description: "第53条および第55条の義務が適用されます"
    obligations:
      - obligation_gpai_base
      - obligation_gpai_systemic
      - "モデル評価の実施"
      - "システミックリスクの評価と軽減"
      - "重大インシデントの報告"
      - "適切なサイバーセキュリティ保護"

  GPAI_OPENSOURCE:
    title: "オープンソースGPAI"
    description: "軽減された義務が適用されます"
    obligations:
      - "技術文書の作成"
      - "EU著作権法の遵守"

  GPAI_PROVIDER:
    title: "GPAIプロバイダー"
    description: "第53条の義務が適用されます"
    obligations:
      - obligation_gpai_base
      - "技術文書の作成"
      - "下流プロバイダーへの情報提供"
      - "著作権ポリシーの遵守"
      - "学習データの要約の公開"

  HIGH_RISK_ANNEX_I:
    title: "ハイリスク（附属書I）"
    description: "製品安全規制に基づくハイリスクAIシステム"
    obligations:
      - obligation_provider_high_risk
      - obligation_deployer_high_risk
      - "第三者適合性評価"
      - "CEマーキング"

  HIGH_RISK:
    title: "ハイリスクAIシステム"
    description: "附属書IIIに基づくハイリスクAIシステム"
    obligations:
      - obligation_provider_high_risk
      - obligation_deployer_high_risk
      - "リスク管理システム"
      - "データガバナンス"
      - "技術文書"
      - "記録保持"
      - "人間による監督"

  PRODUCT_MANUFACTURER:
    title: "製品製造者"
    description: "AIシステムを統合した製品の製造者"
    obligations:
      - "製品安全規制の遵守"
      - "AI要件の確保"

  COMPLIANCE_REQUIRED:
    title: "コンプライアンス義務あり"
    description: "特定された義務を遵守する必要があります"
    obligations:
      - obligation_ai_literacy
